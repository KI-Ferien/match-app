<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KI-Ferien.de | Kosmische Analyse</title>
    <style>
        :root { --glow: #0096ff; --gold: #ffcc00; --bg: #02050a; --cta: #ff6b6b; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            background-color: var(--bg); color: white; font-family: 'Helvetica Neue', Arial, sans-serif;
            min-height: 100vh; overflow-x: hidden;
            display: flex; justify-content: center; align-items: center;
            background: radial-gradient(circle at center, #0a1e3b 0%, #02040a 100%);
        }

        /* Sternenschleier-Effekt */
        .stars-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none; }
        .star { position: absolute; background: white; border-radius: 50%; opacity: 0.5; animation: twinkle var(--t) infinite ease-in-out; }
        @keyframes twinkle { 0%, 100% { opacity: 0.2; transform: scale(1); } 50% { opacity: 0.8; transform: scale(1.3); } }

        .container { 
            position: relative; z-index: 10; width: 95%; max-width: 1200px; 
            display: grid; grid-template-columns: 1fr 450px 1fr; gap: 30px; align-items: center; 
        }

        .zodiac-grid { display: grid; grid-template-columns: 1fr; gap: 12px; }
        
        .zodiac-btn { 
            background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); 
            padding: 18px; border-radius: 15px; cursor: pointer; text-align: center; 
            transition: 0.3s; font-weight: bold; letter-spacing: 1px;
        }
        .zodiac-btn:hover { background: rgba(0, 150, 255, 0.15); border-color: var(--glow); }
        .zodiac-btn.active { border-color: var(--glow); box-shadow: 0 0 20px var(--glow); background: rgba(0, 150, 255, 0.2); color: white; }

        .crystal-ball { 
            background: rgba(255,255,255,0.03); border: 1px solid rgba(0, 150, 255, 0.4); 
            border-radius: 50%; width: 450px; height: 450px; 
            display: flex; flex-direction: column; justify-content: center; align-items: center; 
            padding: 50px; box-shadow: inset 0 0 60px rgba(0,150,255,0.2), 0 0 40px rgba(0,0,0,0.5); 
            backdrop-filter: blur(15px); text-align: center;
        }

        h2 { color: var(--gold); font-size: 0.8rem; letter-spacing: 4px; text-transform: uppercase; margin-bottom: 25px; }
        
        input, select, textarea { 
            width: 100%; background: rgba(255,255,255,0.07); border: 1px solid rgba(255,255,255,0.2); 
            color: white; padding: 12px; border-radius: 10px; margin-bottom: 12px; font-size: 0.9rem;
        }
        textarea { resize: none; }
        
        .cta-btn { 
            background: var(--cta); color: white; padding: 18px; border-radius: 50px; 
            border: none; font-weight: bold; cursor: pointer; width: 100%; 
            margin-top: 10px; font-size: 1rem; letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4); transition: 0.3s;
        }
        .cta-btn:hover { transform: scale(1.03); filter: brightness(1.1); }
        .cta-btn:disabled { background: #444; cursor: not-allowed; box-shadow: none; }
        
        @media (max-width: 1000px) { 
            .container { grid-template-columns: 1fr; } 
            .crystal-ball { width: 100%; height: auto; border-radius: 30px; aspect-ratio: 1/1; }
            .zodiac-grid { grid-template-columns: 1fr 1fr; }
        }
    </style>
</head>
<body>

<div class="stars-container" id="starfield"></div>

<div class="container">
    <div class="zodiac-grid" id="grid-left"></div>
    
    <div class="crystal-ball">
        <h2>KI-FERIEN /ASTRO</h2>
        <input type="email" id="email" placeholder="Deine Email-Adresse">
        
        <select id="count" onchange="updateExtras()">
            <option value="1">1 Person (Solo-Reise)</option>
            <option value="2">2 Personen (Partner-Check)</option>
        </select>
        
        <div id="extras" style="width: 100%;"></div>
        
        <textarea id="hobbies" placeholder="Welche Schwingungen suchst du? (z.B. Natur, Party, Ruhe...)" rows="2"></textarea>
        
        <button class="cta-btn" id="goBtn" onclick="startAnalysis()">KOSMOS BEFRAGEN</button>
    </div>
    
    <div class="zodiac-grid" id="grid-right"></div>
</div>

<script>
    const signs = ["Widder", "Stier", "Zwillinge", "Krebs", "Löwe", "Jungfrau", "Waage", "Skorpion", "Schütze", "Steinbock", "Wassermann", "Fische"];
    let selectedSign = "";

    // 1. Sternen-Hintergrund initialisieren
    const field = document.getElementById('starfield');
    for(let i=0; i<120; i++) {
        const s = document.createElement('div'); s.className='star';
        s.style.left = Math.random()*100+'%'; s.style.top = Math.random()*100+'%';
        const size = Math.random()*2.5+'px';
        s.style.width = s.style.height = size;
        s.style.setProperty('--t', Math.random()*3+2+'s');
        field.appendChild(s);
    }

    // 2. Sternzeichen-Buttons bauen
    signs.forEach((s, i) => {
        const b = document.createElement('div'); 
        b.className='zodiac-btn'; 
        b.innerText = s;
        b.onclick = () => { 
            document.querySelectorAll('.zodiac-btn').forEach(x=>x.classList.remove('active')); 
            b.classList.add('active'); 
            selectedSign = s; 
        };
        document.getElementById(i < 6 ? 'grid-left' : 'grid-right').appendChild(b);
    });

    // 3. Zweites Sternzeichen einblenden bei 2 Personen
    function updateExtras() {
        const div = document.getElementById('extras'); 
        div.innerHTML = "";
        if(document.getElementById('count').value === "2") {
            div.innerHTML = '<select id="extra-sign" class="extra-sign">' + 
                signs.map(s => `<option value="${s}">Partner: ${s}</option>`).join('') + 
                '</select>';
        }
    }

    // 4. Analyse-Logik
    async function startAnalysis() {
        const email = document.getElementById('email').value;
        const hobbies = document.getElementById('hobbies').value;
        
        if(!selectedSign || !email) {
            return alert("Bitte wähle dein Sternzeichen und gib deine Email ein.");
        }
        
        const btn = document.getElementById('goBtn');
        btn.disabled = true; 
        btn.innerText = "Sterne werden synchronisiert...";

        const zodiacs = [selectedSign];
        const extra = document.getElementById('extra-sign');
        if(extra) zodiacs.push(extra.value);

        try {
            const res = await fetch('/.netlify/functions/match', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, zodiacs, hobbies })
            });
            
            const data = await res.json();
            
            // Weiterleitung zur Ergebnisseite mit Ziel-Übergabe
            const target = data.destination || "Santorini";
            window.location.href = `reise.html?destination=${encodeURIComponent(target)}&signs=${zodiacs.join(',')}&v=92`;
            
        } catch(e) {
            // Fallback falls der Server hakt
            window.location.href = `reise.html?destination=Porto&signs=${zodiacs.join(',')}&v=85`;
        }
    }
</script>
</body>
</html>